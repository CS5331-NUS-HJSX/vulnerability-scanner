from crawlerhttp import CrawlerHttpSubmission, CrawlerHttpResponse

def readInput(path):
    inputs = []
    with open(path) as f:
        for line in f:
            inputs = inputs + [line.rstrip()]
    return inputs

codeInjectionInput = readInput("servercodeinjection.txt")
expectedstring = "Ping a Host"

def attack(submission : CrawlerHttpSubmission):
    print("Attacking " + submission.url)
    attackFormSubmission = []
    for i in codeInjectionInput:
        duplicate = submission.duplicate()
        duplicate.alterData(i)
        duplicateSubmission = duplicate.submit()
        if(duplicateSubmission is None):
            print(submission.pageUrl + " attack failure")
            break
        else:
            if duplicateSubmission.getPage().find(expectedstring) != -1:
                attackFormSubmission = attackFormSubmission + [duplicate]            
    return attackFormSubmission





